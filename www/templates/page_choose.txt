{capture assign="page_title"}choose{/capture}
{capture assign="extra_head"}
<script src="{$cfg.abs_root_url}javascript/youarehere.getlatlon.js"></script>
{/capture}
{include file="inc_head.txt"}

{include file="inc_map_getlatlon.txt"}

{if $geojson && $geojson.features|@count}

<ul>
{foreach from=$geojson.features item="row"}
<li><a href="#" onclick="javascript:youarehere_getlatlon_jumpto({$row.geometry.coordinates.1|escape},{$row.geometry.coordinates.0|escape}{if $row.bbox},'{$row.bbox|@implode:","|escape}'{/if});return false;">{$row.properties.text|escape}</a> <small>&#8212; courtesy <span class="hey-look">{$row.properties.layer|@escape}</span> / this place has an ID and it is <span class="hey-look">{$row.properties.id|@escape}</span> {if $row.properties.category|@count} / this is a {foreach from=$row.properties.category item="cat" name="cats"}<span class="hey-look">{$cat|@escape}</span>{if !$smarty.foreach.cats.last} and a {/if}{/foreach}{/if}</small></li>
{/foreach}
</ul>

<script type="text/javascript">

var geojson = JSON.parse('{$geojson|@json_encode}');
{literal}
$(document).ready(function(){
	var extent = [[-90, -180], [90, 180]];
	var map = youarehere_getlatlon_map();
	map.fitBounds(extent);

	youarehere_getlatlon_set_viewport(geojson);
	youarehere_getlatlon_draw_features(geojson);

	$("#getlatlon-crosshairs").dblclick(function(e){
		var offset = (e.shiftKey) ? -1 : 1;
		var map = youarehere_getlatlon_map();
		map.setZoom(map.getZoom() + offset);
	});
});
{/literal}
</script>

{else}

{if $geojson}
<p class="error"><q>{$smarty.get.q|escape}</q> is not any place that we know about. Try again?</p>
{/if}

<script type="text/javascript">
{literal}
$(document).ready(function(){
	var extent = [[-90, -180], [90, 180]];
	var map = youarehere_getlatlon_map();
	map.fitBounds(extent);
});
{/literal}
</script>

{/if}

{include file="inc_foot.txt"}
